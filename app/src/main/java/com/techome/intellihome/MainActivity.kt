package com.techome.intellihome

import android.util.Log
import android.Manifest
import android.R
import android.annotation.SuppressLint
import android.app.DatePickerDialog
import android.app.NotificationChannel
import android.app.NotificationManager
import android.content.Context
import android.content.pm.PackageManager
import android.net.Uri
import android.os.Build
import android.os.Bundle
import android.os.Handler
import android.os.Looper
import android.widget.Toast
import androidx.activity.ComponentActivity
import androidx.activity.compose.rememberLauncherForActivityResult
import androidx.activity.compose.setContent
import androidx.activity.enableEdgeToEdge
import androidx.activity.result.contract.ActivityResultContracts
import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.Arrangement
import androidx.compose.foundation.layout.Box
import androidx.compose.foundation.layout.Column
import androidx.compose.foundation.layout.Row
import androidx.compose.foundation.layout.Spacer
import androidx.compose.foundation.layout.fillMaxSize
import androidx.compose.foundation.layout.fillMaxWidth
import androidx.compose.foundation.layout.height
import androidx.compose.foundation.layout.padding
import androidx.compose.foundation.layout.width
import androidx.compose.foundation.lazy.LazyColumn
import androidx.compose.foundation.lazy.items
import androidx.compose.foundation.pager.VerticalPager
import androidx.compose.foundation.pager.rememberPagerState
import androidx.compose.foundation.rememberScrollState
import androidx.compose.foundation.text.BasicTextField
import androidx.compose.foundation.text.KeyboardOptions
import androidx.compose.foundation.verticalScroll
import androidx.compose.material.LocalTextStyle
import androidx.compose.material3.Button
import androidx.compose.material3.DropdownMenu
import androidx.compose.material3.DropdownMenuItem
import androidx.compose.material3.MaterialTheme
import androidx.compose.material3.Scaffold
import androidx.compose.material3.Text
import androidx.compose.material3.TextButton
import androidx.compose.material3.AlertDialog
import androidx.compose.runtime.Composable
import androidx.compose.runtime.LaunchedEffect
import androidx.compose.runtime.getValue
import androidx.compose.runtime.mutableStateListOf
import androidx.compose.runtime.mutableStateOf
import androidx.compose.runtime.remember
import androidx.compose.runtime.saveable.rememberSaveable
import androidx.compose.runtime.setValue
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.platform.LocalContext
import androidx.compose.ui.text.input.KeyboardType
import androidx.compose.ui.text.input.PasswordVisualTransformation
import androidx.compose.ui.tooling.preview.Preview
import androidx.compose.ui.unit.dp
import androidx.core.app.ActivityCompat
import androidx.core.app.NotificationCompat
import androidx.core.app.NotificationManagerCompat
import androidx.core.content.ContextCompat
import coil.compose.AsyncImage
import java.io.File
import com.google.android.gms.maps.model.LatLng
import com.google.maps.android.compose.GoogleMap
import com.google.maps.android.compose.Marker
import com.google.maps.android.compose.MarkerState
import androidx.compose.material3.OutlinedTextField
import androidx.compose.runtime.DisposableEffect
import androidx.compose.ui.platform.LocalTextInputService
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.text.style.TextAlign
import androidx.compose.ui.unit.sp
import kotlinx.coroutines.CoroutineScope
import kotlinx.coroutines.Dispatchers
import kotlinx.coroutines.launch
import java.io.DataInputStream
import java.io.DataOutputStream
import java.net.Socket
import java.util.*
import javax.mail.Authenticator
import javax.mail.Message
import javax.mail.PasswordAuthentication
import javax.mail.Session
import javax.mail.Transport
import javax.mail.internet.InternetAddress
import javax.mail.internet.MimeMessage
import javax.xml.datatype.DatatypeConstants.MONTHS


class MainActivity : ComponentActivity() {
    companion object {
        val globalHouseList = mutableListOf<HouseDetails>()
        var cardInfo = CardInfo()
        var tempUser: User? = null
    }

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        enableEdgeToEdge()

        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.TIRAMISU) {
            if (ContextCompat.checkSelfPermission(this, Manifest.permission.POST_NOTIFICATIONS) != PackageManager.PERMISSION_GRANTED) {
                ActivityCompat.requestPermissions(this, arrayOf(Manifest.permission.POST_NOTIFICATIONS), 1)
            }
        }
        // Asegurarse de que el usuario Admin est√© en el archivo
        addDefaultAdminUser()
        var photo1 = Uri.parse("data:image/jpeg;base64,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")
        var photo2 = Uri.parse("data:image/jpeg;base64,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")
        var photo3 = Uri.parse("data:image/jpeg;base64,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")
        var photos = mutableListOf<Uri>()
        photos.add(photo1)
        photos.add(photo2)
        photos.add(photo3)
        var Iot = IOT("", "", "", true)
        var Iot1 = IOT("Luz", "Automatica", "Cochera", true)
        var Devices1 = mutableListOf<IOT>()
        Devices1.add(Iot1)
        Devices1.add(Iot1)
        Devices1.add(Iot1)
        var photosUri = photos.toList()
        var House1 = HouseDetails(4, 3, 2, "sillones, mesas", "Amplia y bonita", photosUri, "Pagos", Devices1, Iot, true, "")
        var House2 = HouseDetails(4, 3, 2, "sillones, mesas", "Amplia y bonita", photosUri, "Pagos", Devices1, Iot, false, "")
        var House3 = HouseDetails(4, 3, 2, "sillones, mesas", "Amplia y bonita", photosUri, "Pagos", Devices1, Iot, true, "")
        var House4 = HouseDetails(4, 3, 2, "sillones, mesas", "Amplia y bonita", photosUri, "Pagos", Devices1, Iot, false, "")
        globalHouseList.add(House1)
        globalHouseList.add(House2)
        globalHouseList.add(House3)
        globalHouseList.add(House4)
        setContent {
            MaterialTheme {
                Scaffold(modifier = Modifier.fillMaxSize()) { innerPadding ->
                    var currentScreen by rememberSaveable { mutableStateOf("login") }

                    // Funci√≥n para cambiar la pantalla
                    fun changeScreen(screen: String) {
                        currentScreen = screen
                    }

                    when (currentScreen) {
                        "login" -> LoginScreen(
                            modifier = Modifier.padding(innerPadding),
                            onForgotPassword = { changeScreen("requestEmail") },
                            onRegisterClick = { changeScreen("register") }  // Navega a la pantalla de registro
                        )
                        "requestEmail" -> RequestPasswordResetScreen(
                            onEmailSent = { changeScreen("verifyCode") }
                        )
                        "verifyCode" -> VerifyRecoveryCodeScreen(
                            onCodeVerified = { changeScreen("resetPassword") },
                            onError = { changeScreen("requestEmail") }
                        )
                        "resetPassword" -> ResetPasswordScreen(
                            onPasswordReset = { changeScreen("login") }
                        )
                        "register" -> RegisterUserScreen(
                            onBack = { changeScreen("login") },  // Vuelve a la pantalla de login
                            onPaymentClick = { changeScreen("payment") }  // Navega a la pantalla de pago
                        )
                        "payment" -> PaymentScreen(
                            onBack = { changeScreen("register") }  // Funci√≥n para regresar a la pantalla de registro
                        )
                    }
                }
            }
        }
    }
    // Funci√≥n para agregar el usuario Admin con la contrase√±a predeterminada si no existe en el archivo
    private fun addDefaultAdminUser() {
        val file = File(filesDir, "users.txt")
        if (!file.exists() || !file.readText().contains("Admin")) {
            file.appendText("Admin,Administrador,admin@tec.com,TEC2024,30,Apartamento Inteligente,Carro\n")
        }
    }
}


data class User(
    var alias: String,
    var fullName: String,
    var email: String,
    var password: String,
    val dateOfBirth: String,
    var houseType: String,
    var vehicleType: String,
    var card: CardInfo = CardInfo("1","1","1", "1"),
    var IsRenting: Boolean = false
)

data class CardInfo(
    var cardholderName: String = "",
    var cardNumber: String = "",
    var expiryDate: String = "",
    var securityCode: String = ""
)

data class HouseDetails(
    val capacity: Int,
    val rooms: Int,
    val bathrooms: Int,
    val amenities: String,
    val generalFeatures: String,
    val photos: List<Uri>,  // Uri para las im√°genes de la casa
    val paymentPlan: String,
    //val latitude: Double,
    //val longitude: Double
    val Devices: MutableList<IOT> = mutableListOf<IOT>(),
    var Iot: IOT,
    var status: Boolean,
    var RentalDates: String
)

data class IOT(
    var Device: String = "",
    var Type: String = "",
    var Location: String = "",
    var Activated: Boolean
)
var isAppEnabled by mutableStateOf(true) // Variable para habilitar/deshabilitar el aplicativo
var isLoggedIn by mutableStateOf(false)  // Variable global para estado de sesi√≥n
var isAdmin by mutableStateOf(false)     // Variable global para saber si el usuario es Admin
var currentUser by mutableStateOf(User("A", "B", "C", "D", "E", "F", "G"))

// Funci√≥n para validar contrase√±as
fun isPasswordValid(password: String): Boolean {
    val passwordPattern = "^(?=.*[0-9])(?=.*[a-z])(?=.*[A-Z])(?=.*[@#\$%^&+=!])(?=\\S+\$).{8,}\$"
    val passwordMatcher = Regex(passwordPattern)
    return passwordMatcher.matches(password)
}




// Funci√≥n para guardar los datos de usuario en un archivo
fun saveUserToFile(context: android.content.Context, user: User) {
    val file = File(context.filesDir, "users.txt")
    Log.d("UserFilePath", "Ruta del archivo: ${file.absolutePath}")


    try {
        // Verifica si el archivo existe, si no, lo crea
        if (!file.exists()) {
            val isFileCreated = file.createNewFile()
            println("Archivo creado: $isFileCreated en ${file.absolutePath}")
        }

        // Comprobaci√≥n de contenido duplicado
        val lines = file.readLines()
        val userExists = lines.any { it.startsWith(user.alias) }

        if (!userExists) {
            file.appendText("${user.alias},${user.fullName},${user.email},${user.password},${user.dateOfBirth},${user.houseType},${user.vehicleType}\n")
            println("Usuario '${user.alias}' guardado correctamente.")
        } else {
            println("El usuario '${user.alias}' ya existe.")
        }

    } catch (e: Exception) {
        e.printStackTrace()
        println("Error al guardar el usuario: ${e.message}")
    }
}

fun deleteUserFromFile(context: android.content.Context, userAlias: String) {
    val file = File(context.filesDir, "users.txt")
    Log.d("UserFilePath", "Ruta del archivo: ${file.absolutePath}")


    if (file.exists()) {
        // Leer todas las l√≠neas del archivo
        val lines = file.readLines().toMutableList()

        // Filtrar las l√≠neas que no corresponden al usuario que deseas eliminar
        val updatedLines = lines.filter { !it.startsWith("$userAlias,") }

        // Sobrescribir el archivo con las l√≠neas actualizadas
        file.writeText(updatedLines.joinToString("\n"))
    }
}


// Funci√≥n para actualizar la contrase√±a del Admin en el archivo
fun updateAdminPassword(context: android.content.Context, newPassword: String) {
    val file = File(context.filesDir, "users.txt")
    Log.d("UserFilePath", "Ruta del archivo: ${file.absolutePath}")

    if (file.exists()) {
        val lines = file.readLines()
        val newLines = lines.map { line ->
            if (line.startsWith("Admin")) {
                val parts = line.split(",")
                "Admin,${parts[1]},${parts[2]},$newPassword,${parts[4]},${parts[5]},${parts[6]}"
            } else {
                line
            }
        }
        file.writeText(newLines.joinToString("\n"))
    }
}

// Funci√≥n para hacer a un usuario administrador
fun makeUserAdmin(context: android.content.Context, user: User) {
    val file = File(context.filesDir, "users.txt")
    Log.d("UserFilePath", "Ruta del archivo: ${file.absolutePath}")

    if (file.exists()) {
        val lines = file.readLines()
        val newLines = lines.map { line ->
            val parts = line.split(",")
            if (parts[0] == user.alias) {
                "${user.alias},Administrador,${user.email},${user.password},${user.dateOfBirth},${user.houseType},${user.vehicleType}"
            } else {
                line
            }
        }
        file.writeText(newLines.joinToString("\n"))
    }
}

@Composable
fun LoginScreen(
    modifier: Modifier = Modifier,
    onForgotPassword: () -> Unit,
    onRegisterClick: () -> Unit // Se agrega este par√°metro para manejar la navegaci√≥n
) {
    var username by rememberSaveable { mutableStateOf("") }
    var password by rememberSaveable { mutableStateOf("") }
    val context = LocalContext.current

    if (isLoggedIn) {
        if (isAdmin) {
            AdminMenuScreen(context = context)
        } else {
            UserMenuScreen()
        }
    } else {
        Column(
            modifier = modifier.fillMaxSize(),
            verticalArrangement = Arrangement.Center,
            horizontalAlignment = Alignment.CenterHorizontally
        ) {
            // Mostrar mensaje si el aplicativo est√° deshabilitado
            if (!isAppEnabled) {
                Text("El aplicativo est√° deshabilitado. Solo el administrador puede iniciar sesi√≥n.", Modifier.padding(16.dp))
            }

            // Campo para el nombre de usuario
            BasicTextField(
                value = username,
                onValueChange = { username = it },
                modifier = Modifier
                    .fillMaxWidth()
                    .padding(16.dp),
                decorationBox = { innerTextField ->
                    Box(modifier = Modifier.padding(16.dp)) {
                        if (username.isEmpty()) Text("Usuario/Alias")
                        innerTextField()
                    }
                }
            )

            // Campo para la contrase√±a
            BasicTextField(
                value = password,
                onValueChange = { password = it },
                modifier = Modifier
                    .fillMaxWidth()
                    .padding(16.dp),
                visualTransformation = PasswordVisualTransformation(),
                decorationBox = { innerTextField ->
                    Box(modifier = Modifier.padding(16.dp)) {
                        if (password.isEmpty()) Text("Contrase√±a")
                        innerTextField()
                    }
                }
            )

            // Bot√≥n de login
            Button(onClick = {
                val userData = readUserDataFromFile(context, username)
                currentUser = readUserDataFromFile(context, username)

                // Permitir solo al administrador iniciar sesi√≥n si la app est√° deshabilitada
                if (!isAppEnabled && username != "Admin") {
                    Toast.makeText(context, "El aplicativo est√° deshabilitado. Solo el administrador puede iniciar sesi√≥n.", Toast.LENGTH_SHORT).show()
                    return@Button
                }

                if (username == "Admin" && password == "TEC2024") {
                    isLoggedIn = true
                    isAdmin = true
                    Toast.makeText(context, "Ingreso exitoso como Admin", Toast.LENGTH_SHORT).show()
                    startPasswordReminder(context) // Inicia recordatorio de contrase√±a
                } else if (userData.password == password) {
                    isLoggedIn = true
                    isAdmin = false
                    Toast.makeText(context, "Ingreso exitoso", Toast.LENGTH_SHORT).show()
                } else {
                    Toast.makeText(
                        context,
                        "Contrase√±a o usuario incorrectos",
                        Toast.LENGTH_SHORT
                    ).show()
                }
            }) {
                Text("Login")
            }

            // Mostrar el bot√≥n de registro solo si la app est√° habilitada
            if (isAppEnabled) {
                Spacer(modifier = Modifier.height(16.dp))
                Button(onClick = onRegisterClick) {  // Llama a onRegisterClick en lugar de modificar showRegister
                    Text("Registrar nuevo usuario")
                }
            }

            Spacer(modifier = Modifier.height(16.dp))
            TextButton(onClick = onForgotPassword) {
                Text("¬øOlvidaste tu contrase√±a?")
            }
        }
    }
}


//Funcion para poder previsualizar el codigo
@Preview(showBackground = true)
@Composable
fun PreviewLoginScreen() {
    LoginScreen(
        onForgotPassword = {},
        onRegisterClick = {}
    )
}


@Composable
fun RequestPasswordResetScreen(onEmailSent: () -> Unit) {
    var email by rememberSaveable { mutableStateOf("") }
    val context = LocalContext.current

    Column(
        modifier = Modifier
            .fillMaxSize()
            .padding(16.dp),
        verticalArrangement = Arrangement.Center,
        horizontalAlignment = Alignment.CenterHorizontally
    ) {
        Text("Recuperar contrase√±a")

        BasicTextField(
            value = email,
            onValueChange = { email = it },
            modifier = Modifier
                .fillMaxWidth()
                .padding(16.dp),
            decorationBox = { innerTextField ->
                Box(modifier = Modifier.padding(16.dp)) {
                    if (email.isEmpty()) Text("Correo electr√≥nico")
                    innerTextField()
                }
            }
        )

        Button(onClick = {
            val user = readUserDataByEmail(context, email)
            if (user != null) {
                sendRecoveryCode(context, email)
                onEmailSent() // Navegar a la pantalla de verificaci√≥n del c√≥digo
            } else {
                Toast.makeText(context, "Correo no encontrado", Toast.LENGTH_SHORT).show()
            }
        }) {
            Text("Enviar c√≥digo")
        }
    }
}

@Preview(showBackground = true)
@Composable
fun PreviewRequestPasswordResetScreen() {
    RequestPasswordResetScreen(onEmailSent = {})
}

@Composable
fun VerifyRecoveryCodeScreen(onCodeVerified: () -> Unit, onError: () -> Unit) {
    var code by rememberSaveable { mutableStateOf("") }
    val context = LocalContext.current

    Column(
        modifier = Modifier
            .fillMaxSize()
            .padding(16.dp),
        verticalArrangement = Arrangement.Center,
        horizontalAlignment = Alignment.CenterHorizontally
    ) {
        Text("Ingrese el c√≥digo de recuperaci√≥n")

        BasicTextField(
            value = code,
            onValueChange = { code = it },
            modifier = Modifier
                .fillMaxWidth()
                .padding(16.dp),
            decorationBox = { innerTextField ->
                Box(modifier = Modifier.padding(16.dp)) {
                    if (code.isEmpty()) Text("C√≥digo de recuperaci√≥n")
                    innerTextField()
                }
            }
        )

        Button(onClick = {
            val sharedPreferences = context.getSharedPreferences("RecoveryPrefs", Context.MODE_PRIVATE)
            val savedCode = sharedPreferences.getString("recovery_code", "")

            if (code == savedCode) {
                onCodeVerified() // Navegar a la pantalla para cambiar contrase√±a
            } else {
                onError() // Manejar el error
            }
        }) {
            Text("Verificar c√≥digo")
        }
    }
}

@Preview(showBackground = true)
@Composable
fun PreviewVerifyRecoveryCodeScreen() {
    VerifyRecoveryCodeScreen(onCodeVerified = {}, onError = {})
}

@Composable
fun ResetPasswordScreen(onPasswordReset: () -> Unit) {
    var newPassword by rememberSaveable { mutableStateOf("") }
    var confirmPassword by rememberSaveable { mutableStateOf("") }
    val context = LocalContext.current

    Column(
        modifier = Modifier
            .fillMaxSize()
            .padding(16.dp),
        verticalArrangement = Arrangement.Center,
        horizontalAlignment = Alignment.CenterHorizontally
    ) {
        Text("Cambiar Contrase√±a")

        BasicTextField(
            value = newPassword,
            onValueChange = { newPassword = it },
            modifier = Modifier
                .fillMaxWidth()
                .padding(16.dp),
            visualTransformation = PasswordVisualTransformation(),
            decorationBox = { innerTextField ->
                Box(modifier = Modifier.padding(16.dp)) {
                    if (newPassword.isEmpty()) Text("Nueva contrase√±a")
                    innerTextField()
                }
            }
        )

        BasicTextField(
            value = confirmPassword,
            onValueChange = { confirmPassword = it },
            modifier = Modifier
                .fillMaxWidth()
                .padding(16.dp),
            visualTransformation = PasswordVisualTransformation(),
            decorationBox = { innerTextField ->
                Box(modifier = Modifier.padding(16.dp)) {
                    if (confirmPassword.isEmpty()) Text("Confirmar contrase√±a")
                    innerTextField()
                }
            }
        )

        Button(onClick = {
            if (newPassword == confirmPassword) {
                saveNewPassword(context, newPassword)
                onPasswordReset() // Navegar de vuelta al login
            } else {
                Toast.makeText(context, "Las contrase√±as no coinciden", Toast.LENGTH_SHORT).show()
            }
        }) {
            Text("Cambiar contrase√±a")
        }
    }
}

@Preview(showBackground = true)
@Composable
fun PreviewResetPasswordScreen() {
    ResetPasswordScreen(onPasswordReset = {})
}

// Pantalla del men√∫ de administrador
@Composable
fun AdminMenuScreen(context: Context) {
    var newPassword by rememberSaveable { mutableStateOf("") }
    val users = remember { mutableStateListOf<User>() }
    var showAddHouseScreen by remember { mutableStateOf(false) } // Control para navegar a AddHouseScreen
    var showEditHousesScreen by remember { mutableStateOf(false) }

    // Leer todos los usuarios al iniciar la pantalla
    LaunchedEffect(Unit) {
        users.clear()
        val loadedUsers = readAllUsers(context)
        if (loadedUsers.isNotEmpty()) {
            users.addAll(loadedUsers)
        }
    }

    if (showAddHouseScreen) {
        // Mostrar la pantalla para agregar casa
        AddHouseScreen(onBack = { showAddHouseScreen = false })
    } else if (showEditHousesScreen) {
        EditHousesScreen(onBack = { showEditHousesScreen = false })
    } else {
        Column(
            modifier = Modifier
                .fillMaxSize()
                .padding(16.dp),
            verticalArrangement = Arrangement.Top,
            horizontalAlignment = Alignment.CenterHorizontally
        ) {
            Spacer(modifier = Modifier.height(50.dp))

            // Mensaje de bienvenida
            Text("Bienvenido, Admin", style = MaterialTheme.typography.headlineSmall)

            Spacer(modifier = Modifier.height(16.dp))

            // Bot√≥n para habilitar/deshabilitar el aplicativo
            Button(onClick = {
                isAppEnabled = !isAppEnabled
                Toast.makeText(
                    context,
                    if (isAppEnabled) "Aplicativo habilitado" else "Aplicativo deshabilitado",
                    Toast.LENGTH_SHORT
                ).show()
            }) {
                Text(if (isAppEnabled) "Deshabilitar aplicativo" else "Habilitar aplicativo")
            }

            Spacer(modifier = Modifier.height(50.dp))

            // Campo para cambiar la contrase√±a
            OutlinedTextField(
                value = newPassword,
                onValueChange = { newPassword = it },
                label = { Text("Nueva contrase√±a") },
                visualTransformation = PasswordVisualTransformation(),
                modifier = Modifier
                    .fillMaxWidth()
                    .padding(vertical = 8.dp)
            )

            // Bot√≥n para actualizar la contrase√±a
            Button(onClick = {
                if (newPassword.isNotEmpty()) {
                    updateAdminPassword(context, newPassword)
                    Toast.makeText(context, "Contrase√±a actualizada", Toast.LENGTH_SHORT).show()
                    newPassword = "" // Limpiar el campo despu√©s de actualizar
                } else {
                    Toast.makeText(context, "Por favor ingrese una nueva contrase√±a", Toast.LENGTH_SHORT).show()
                }
            }) {
                Text("Cambiar Contrase√±a")
            }

            Spacer(modifier = Modifier.height(16.dp))

            // Lista de usuarios
            Text("Lista de usuarios:", style = MaterialTheme.typography.headlineSmall)
            if (users.isEmpty()) {
                Text("No hay usuarios registrados", modifier = Modifier.padding(16.dp))
            } else {
                LazyColumn(modifier = Modifier
                    .fillMaxWidth()
                    .padding(vertical = 8.dp)) {
                    items(users) { user ->
                        Row(
                            modifier = Modifier
                                .fillMaxWidth()
                                .padding(8.dp),
                            verticalAlignment = Alignment.CenterVertically
                        ) {
                            Text("${user.alias} - ${user.fullName}", modifier = Modifier.weight(1f))
                            Button(onClick = {
                                if (user.alias != "Admin") {
                                    makeUserAdmin(context, user)
                                    Toast.makeText(
                                        context,
                                        "${user.alias} ahora es administrador",
                                        Toast.LENGTH_SHORT
                                    ).show()
                                }
                            }) {
                                Text("Hacer Admin")
                            }
                        }
                    }
                }
            }

            Spacer(modifier = Modifier.height(16.dp))

            // Bot√≥n para cerrar sesi√≥n
            Button(onClick = {
                isLoggedIn = false
                isAdmin = false
            }) {
                Text("Cerrar sesi√≥n")
            }

            Spacer(modifier = Modifier.height(16.dp))

            // Bot√≥n para agregar una casa
            Button(onClick = { showAddHouseScreen = true }) {
                Text("Agregar Nueva Casa")
            }

            Spacer(modifier = Modifier.height(16.dp))

            // Bot√≥n para editar casas
            Button(onClick = { showEditHousesScreen = true }) {
                Text("Editar Casas")
            }
        }
    }
}


@Preview(showBackground = true)
@Composable
fun PreviewAdminMenuScreen() {
    val context = LocalContext.current // Necesario para el contexto
    AdminMenuScreen(context = context)
}

//----------------------------------------------------------------------------------------------------------------
@Composable
fun EditHousesScreen(onBack: () -> Unit) {
    var selectedHouse by remember { mutableStateOf<HouseDetails?>(null) } // Casa seleccionada para edici√≥n
    var showIOTDevicesScreen by remember { mutableStateOf(false) }
    var showConfirmationDialog by remember { mutableStateOf(false) }
    var isActivating by remember { mutableStateOf(true) }
    var showEditHouseDetailsScreen by remember { mutableStateOf(false) }  // Control para mostrar EditHouseDetailsScreen

    if (showEditHouseDetailsScreen && selectedHouse != null) {
        EditHouseDetailsScreen(
            house = selectedHouse!!,
            onSave = { updatedHouse ->
                val index = MainActivity.globalHouseList.indexOf(selectedHouse)
                if (index >= 0) {
                    MainActivity.globalHouseList[index] = updatedHouse // Actualizar la casa en la lista
                }
                selectedHouse = null
                showEditHouseDetailsScreen = false
            },
            onCancel = {
                selectedHouse = null
                showEditHouseDetailsScreen = false
            }
        )
    }else if (showIOTDevicesScreen && selectedHouse != null){
        showIOTDevicesScreen(
            house = selectedHouse!!,
            onSave = { updatedHouse ->
                val index = MainActivity.globalHouseList.indexOf(selectedHouse)
                if (index >= 0) {
                    MainActivity.globalHouseList[index] = updatedHouse // Actualizar la casa en la lista
                }
                selectedHouse = null
                showEditHouseDetailsScreen = false
            },
            onCancel = {
                selectedHouse = null
                showEditHouseDetailsScreen = false
            }
        )
    } else {
        Column(
            modifier = Modifier
                .fillMaxSize()
                .padding(16.dp)
                .verticalScroll(rememberScrollState())
        ) {
            Text("Editar Casas")

            for (house in MainActivity.globalHouseList){
                Text("Capacidad: ${house.capacity}")
                Text("Habitaciones: ${house.rooms}")
                Text("Ba√±os: ${house.bathrooms}")
                Text("Amenities: ${house.amenities}")
                Text("Caracter√≠sticas Generales: ${house.generalFeatures}")
                Text("Plan de Pago: ${house.paymentPlan}")

                Spacer(modifier = Modifier.height(8.dp))
                Button(onClick = {
                    selectedHouse = house // Seleccionar la casa actual
                    showEditHouseDetailsScreen = true // Mostrar pantalla de edici√≥n
                }) {
                    Text("Agregar dispositivos")
                }

                Spacer(modifier = Modifier.height(8.dp))
                Button(onClick = {
                    selectedHouse = house // Seleccionar la casa actual
                    showIOTDevicesScreen = true
                }) {
                    Text("Ver dispositivos")
                }

                Spacer(modifier = Modifier.height(8.dp))
                Button(onClick = {
                    selectedHouse = house // Seleccionar la casa actual
                    isActivating = true
                    showConfirmationDialog = true
                }) {
                    Text("Activar")
                }
                Spacer(modifier = Modifier.height(8.dp))
                Button(onClick = {
                    selectedHouse = house // Seleccionar la casa actual
                    isActivating = false
                    showConfirmationDialog = true
                }) {
                    Text("Desactivar")
                }

            }

            Spacer(modifier = Modifier.height(16.dp))

            Button(onClick = onBack) {
                Text("Volver")
            }
            if (showConfirmationDialog && selectedHouse != null) {
                AlertDialog(
                    onDismissRequest = {
                        showConfirmationDialog = false
                    },
                    title = {
                        Text(text = "Confirmaci√≥n")
                    },
                    text = {
                        Text(
                            text = if (isActivating)
                                "¬øEst√°s seguro de que deseas activar esta casa?"
                            else
                                "¬øEst√°s seguro de que deseas desactivar esta casa?"
                        )
                    },
                    confirmButton = {
                        Button(
                            onClick = {
                                selectedHouse?.status = isActivating
                                showConfirmationDialog = false
                            }
                        ) {
                            Text("Confirmar")
                        }
                    },
                    dismissButton = {
                        Button(
                            onClick = {
                                showConfirmationDialog = false
                            }
                        ) {
                            Text("Cancelar")
                        }
                    }
                )
            }

        }
    }

}

@Preview(showBackground = true)
@Composable
fun PreviewEditHouseScreen() {
    EditHousesScreen(onBack={})
}

@Composable
fun showIOTDevicesScreen(house: HouseDetails, onSave: (HouseDetails) -> Unit, onCancel: () -> Unit){
    val index = MainActivity.globalHouseList.indexOf(house)
    var selectedDevice by remember { mutableStateOf<IOT?>(null) }
    var showEditIotsScreen by remember { mutableStateOf(false) }

    if (showEditIotsScreen && selectedDevice != null) {
        EditIotsScreen(
            device = selectedDevice!!,
            onSave = { updated ->
                val index1 = MainActivity.globalHouseList[index].Devices.indexOf(selectedDevice)
                if (index1 >= 0) {
                    MainActivity.globalHouseList[index].Devices[index1] = updated
                }
                selectedDevice = null
                showEditIotsScreen = false
            },
            onCancel = {
                selectedDevice = null
                showEditIotsScreen = false
            }
        )
    } else {
        Column(
            modifier = Modifier
                .fillMaxSize()
                .padding(16.dp)
                .verticalScroll(rememberScrollState())
        ) {
            Text("Editar Casas")
            for (device in MainActivity.globalHouseList[index].Devices){
                Text("Dispositivo IOT: ${device.Device}")
                Text("Tipo de dispositivo: ${device.Type}")
                Text("Ubicaci√≥n: ${device.Location}")

                Spacer(modifier = Modifier.height(8.dp))
                Button(onClick = {
                    selectedDevice = device
                    showEditIotsScreen = true
                }) {
                    Text("Editar")
                }
                Spacer(modifier = Modifier.height(8.dp))
                Button(onClick = {
                    selectedDevice = device
                    val index1 = MainActivity.globalHouseList[index].Devices.indexOf(selectedDevice)
                    MainActivity.globalHouseList[index].Devices.removeAt(index1)
                }) {
                    Text("Eliminar")
                }
                Spacer(modifier = Modifier.height(8.dp))
                Button(onClick = {
                    selectedDevice = device
                    val index1 = MainActivity.globalHouseList[index].Devices.indexOf(selectedDevice)
                    MainActivity.globalHouseList[index].Devices[index1].Activated = !device.Activated
                }) {
                    Text("Desactivar/Activar")
                }
                Text(
                    if (device.Activated) "El dispositivo est√° activado" else "El dispositivo est√° desactivado"
                )
            }
            Spacer(modifier = Modifier.height(8.dp))
            Button(onClick = onCancel) {
                Text("Volver")
            }
        }
    }
}

@Composable
fun EditIotsScreen(device: IOT, onSave: (IOT) -> Unit, onCancel: () -> Unit) {
    var deviceName by rememberSaveable { mutableStateOf(device.Device) }
    var deviceType by rememberSaveable { mutableStateOf(device.Type) }
    var location by rememberSaveable { mutableStateOf(device.Location) }

    Column(
        modifier = Modifier
            .fillMaxSize()
            .padding(16.dp),
        verticalArrangement = Arrangement.Center,
        horizontalAlignment = Alignment.CenterHorizontally
    ) {
        Text("Editar Detalles del Dispositivo")

        Spacer(modifier = Modifier.height(16.dp))

        OutlinedTextField(
            value = deviceName,
            onValueChange = { deviceName = it },
            label = { Text("Nombre del dispositivo") },
            modifier = Modifier.fillMaxWidth()
        )

        Spacer(modifier = Modifier.height(8.dp))

        OutlinedTextField(
            value = deviceType,
            onValueChange = { deviceType = it },
            label = { Text("Tipo de dispositivo") },
            modifier = Modifier.fillMaxWidth()
        )

        Spacer(modifier = Modifier.height(8.dp))

        OutlinedTextField(
            value = location,
            onValueChange = { location = it },
            label = { Text("Ubicaci√≥n en la casa") },
            modifier = Modifier.fillMaxWidth()
        )

        Spacer(modifier = Modifier.height(16.dp))

        Button(onClick = {
            device.Device = deviceName
            device.Type = deviceType
            device.Location = location
            onSave(device)
        }) {
            Text("Guardar Cambios")
        }

        Spacer(modifier = Modifier.height(8.dp))

        Button(onClick = onCancel) {
            Text("Volver")
        }
    }
}

@Composable
fun EditHouseDetailsScreen(house: HouseDetails, onSave: (HouseDetails) -> Unit, onCancel: () -> Unit) {
    var deviceName by rememberSaveable { mutableStateOf("") }
    var deviceType by rememberSaveable { mutableStateOf("") }
    var location by rememberSaveable { mutableStateOf("") }

    Column(
        modifier = Modifier
            .fillMaxSize()
            .padding(16.dp),
        verticalArrangement = Arrangement.Center,
        horizontalAlignment = Alignment.CenterHorizontally
    ) {
        Text("Editar Detalles de la Casa")

        Spacer(modifier = Modifier.height(16.dp))

        // Campos de texto para los detalles adicionales
        OutlinedTextField(
            value = deviceName,
            onValueChange = { deviceName = it },
            label = { Text("Nombre del dispositivo") },
            modifier = Modifier.fillMaxWidth()
        )

        Spacer(modifier = Modifier.height(8.dp))

        OutlinedTextField(
            value = deviceType,
            onValueChange = { deviceType = it },
            label = { Text("Tipo de dispositivo") },
            modifier = Modifier.fillMaxWidth()
        )

        Spacer(modifier = Modifier.height(8.dp))

        OutlinedTextField(
            value = location,
            onValueChange = { location = it },
            label = { Text("Ubicaci√≥n en la casa") },
            modifier = Modifier.fillMaxWidth()
        )

        Spacer(modifier = Modifier.height(16.dp))

        // Bot√≥n para guardar cambios
        Button(onClick = {
            val index = MainActivity.globalHouseList.indexOf(house)
            var IotDevice = IOT(deviceName, deviceType, location, true)
            MainActivity.globalHouseList[index].Devices.add(IotDevice)

            MainActivity.globalHouseList[index].Iot.Device = deviceName
            MainActivity.globalHouseList[index].Iot.Type = deviceType
            MainActivity.globalHouseList[index].Iot.Location = location
        }) {
            Text("Guardar Cambios")
        }

        Spacer(modifier = Modifier.height(8.dp))

        Button(onClick = onCancel) {
            Text("Volver")
        }
    }
}


@Composable
fun AddHouseScreen(
    modifier: Modifier = Modifier,
    onBack: () -> Unit, // Callback para volver al men√∫
    maxPhotos: Int = 3 // N√∫mero m√°ximo de fotos permitido (por defecto: 3)
) {
    // Variables para los campos del formulario
    var capacity by remember { mutableStateOf("") }
    var rooms by remember { mutableStateOf("") }
    var bathrooms by remember { mutableStateOf("") }
    var amenities by remember { mutableStateOf("") }
    var generalFeatures by remember { mutableStateOf("") }
    var photos by remember { mutableStateOf(mutableListOf<Uri>()) }
    val selectedImages = remember { mutableStateListOf<Uri>() }
    val context = LocalContext.current
    // Variable para el plan de pago seleccionado
    var selectedPlan by remember { mutableStateOf("Cuota mensual con servicios b√°sicos") }
    var expanded by remember { mutableStateOf(false) } // Controla si el men√∫ est√° abierto
    var selectedLocation by remember { mutableStateOf<LatLng?>(null) }
    var showSelectLocation by remember { mutableStateOf(false) }


    val launcher = rememberLauncherForActivityResult(
        contract = ActivityResultContracts.GetContent()
    ) { uri: Uri? ->
        uri?.let {
            if (selectedImages.size < maxPhotos) {
                selectedImages.add(it) // Agrega la imagen seleccionada
            }
        }
    }

    val paymentPlans = listOf(
        "Cuota mensual con servicios b√°sicos",
        "Cuota mensual sin servicios b√°sicos",
        "Cuota diaria con servicios b√°sicos"
    )

    if (showSelectLocation) {
        SelectLocationScreen(
            onLocationSelected = { location ->
                selectedLocation = location
                showSelectLocation = false // Volver a la pantalla de agregar casa
            }
        )
    } else {

        Column(
            modifier = modifier
                .fillMaxSize()
                .padding(16.dp),
            verticalArrangement = Arrangement.Top,
            horizontalAlignment = Alignment.CenterHorizontally
        ) {
            // Formulario de detalles importantes
            Text("Agregar nueva casa")

            Spacer(modifier = Modifier.height(16.dp))

            BasicTextField(
                value = capacity,
                onValueChange = { capacity = it },
                modifier = Modifier.fillMaxWidth(),
                decorationBox = { innerTextField ->
                    Box(modifier = Modifier.padding(16.dp)) {
                        if (capacity.isEmpty()) Text("Capacidad de personas")
                        innerTextField()
                    }
                }
            )

            BasicTextField(
                value = rooms,
                onValueChange = { rooms = it },
                modifier = Modifier.fillMaxWidth(),
                decorationBox = { innerTextField ->
                    Box(modifier = Modifier.padding(16.dp)) {
                        if (rooms.isEmpty()) Text("Cantidad de habitaciones")
                        innerTextField()
                    }
                }
            )

            BasicTextField(
                value = bathrooms,
                onValueChange = { bathrooms = it },
                modifier = Modifier.fillMaxWidth(),
                decorationBox = { innerTextField ->
                    Box(modifier = Modifier.padding(16.dp)) {
                        if (bathrooms.isEmpty()) Text("Cantidad de banos")
                        innerTextField()
                    }
                }
            )

            BasicTextField(
                value = amenities,
                onValueChange = { amenities = it },
                modifier = Modifier.fillMaxWidth(),
                decorationBox = { innerTextField ->
                    Box(modifier = Modifier.padding(16.dp)) {
                        if (amenities.isEmpty()) Text("Amenidades")
                        innerTextField()
                    }
                }
            )

            BasicTextField(
                value = generalFeatures,
                onValueChange = { generalFeatures = it },
                modifier = Modifier.fillMaxWidth(),
                decorationBox = { innerTextField ->
                    Box(modifier = Modifier.padding(16.dp)) {
                        if (generalFeatures.isEmpty()) Text("Caracter√≠sticas generales")
                        innerTextField()
                    }
                }
            )

            Box(modifier = Modifier.fillMaxWidth()) {
                Button(onClick = { expanded = true }) {
                    Text(selectedPlan) // Muestra el plan seleccionado
                }

                DropdownMenu(
                    expanded = expanded,
                    onDismissRequest = { expanded = false } // Cierra el men√∫ al hacer clic fuera
                ) {
                    paymentPlans.forEach { plan ->
                        DropdownMenuItem(
                            text = { Text(plan) },
                            onClick = {
                                selectedPlan = plan // Actualiza el plan seleccionado
                                expanded = false // Cierra el men√∫
                            }
                        )
                    }
                }
            }

            Spacer(modifier = Modifier.height(16.dp))

            Button(onClick = {
                showSelectLocation = true // Cambiar a la pantalla de selecci√≥n de ubicaci√≥n
            }) {
                Text("Seleccionar ubicaci√≥n")
            }

            selectedLocation?.let {
                Text("Ubicaci√≥n seleccionada: ${it.latitude}, ${it.longitude}")
            }

            Spacer(modifier = Modifier.height(16.dp))

            // Secci√≥n para subir im√°genes
            Text("Subir imagenes de la casa (Maximo: $maxPhotos fotos)")

            if (selectedImages.size < maxPhotos) {
                Button(onClick = {
                    launcher.launch("image/*") // Abre el selector de im√°genes
                }) {
                    Text("Agregar imagen")
                }
            }

            LazyColumn {
                items(selectedImages) { imageUri ->
                    AsyncImage(
                        model = imageUri,
                        contentDescription = null,
                        modifier = Modifier
                            .width(100.dp)  // Ajusta el ancho
                            .height(100.dp) // Ajusta el alto
                            .padding(8.dp)  // Espacio alrededor de la imagen
                    )
                }
            }

            Spacer(modifier = Modifier.height(16.dp))

            // Bot√≥n para guardar la casa
            Button(onClick = {
                if (capacity.isNotEmpty() && rooms.isNotEmpty() && bathrooms.isNotEmpty() &&
                    amenities.isNotEmpty()
                ) {
                    // Guardar la casa si todo es v√°lido
                    val newHouse = HouseDetails(
                        capacity = capacity.toInt(),
                        rooms = rooms.toInt(),
                        bathrooms = bathrooms.toInt(),
                        amenities = amenities,
                        generalFeatures = generalFeatures,
                        photos = selectedImages.toList(),
                        paymentPlan = selectedPlan,
                        Iot = IOT("", "", "", true),
                        status = true,
                        RentalDates = ""
                        //latitude = selectedLocation!!.latitude,
                        //longitude = selectedLocation!!.longitude
                    )
                    // Agregar la nueva casa a la lista global
                    MainActivity.globalHouseList.add(newHouse)

                    // Mostrar confirmaci√≥n
                    Toast.makeText(context, "Casa agregada con √©xito", Toast.LENGTH_SHORT).show()

                    onBack()


                } else {
                    // Mostrar error si faltan datos
                    Toast.makeText(
                        context,
                        "Complete todos los campos y agregue al menos $maxPhotos im√°genes",
                        Toast.LENGTH_SHORT
                    ).show()
                }
            }) {
                Text("Guardar casa")
            }

        }
    }

}

@SuppressLint("MissingPermission")
@Composable
fun SelectLocationScreen(onLocationSelected: (LatLng) -> Unit) {
    val context = LocalContext.current
    var selectedLocation by remember { mutableStateOf<LatLng?>(null) }

    // Ubicaci√≥n inicial (podr√≠a ser la ubicaci√≥n actual del usuario o un punto por defecto)
    val initialLocation = LatLng(-34.0, 151.0) // Ejemplo, se puede cambiar
  /*
    val cameraPositionState = rememberCameraPositionState {
        position = com.google.maps.android.compose.CameraPositionState.fromLatLngZoom(initialLocation, 10f)
    }
*/
    Box(Modifier.fillMaxSize()) {
        GoogleMap(
            modifier = Modifier.fillMaxSize(),
            //cameraPositionState = cameraPositionState,
            onMapClick = { latLng ->
                selectedLocation = latLng
            }
        )

        // Muestra un marcador donde el usuario hace click
        selectedLocation?.let { location ->
            Marker(
                state = MarkerState(position = location),
                title = "Ubicaci√≥n seleccionada"
            )
        }

        // Bot√≥n para confirmar la ubicaci√≥n seleccionada
        Button(
            onClick = {
                selectedLocation?.let { onLocationSelected(it) }
            },
            modifier = Modifier
                .align(Alignment.BottomCenter)
                .padding(16.dp)
        ) {
            Text("Confirmar ubicaci√≥n")
        }
    }
}

// Pantalla del men√∫ de usuario com√∫n
@Composable
fun UserMenuScreen() {
    // Estado para controlar si el usuario est√° editando los datos o viendo casas
    var isEditing by rememberSaveable { mutableStateOf(false) }
    var isViewingHouses by rememberSaveable { mutableStateOf(false) }
    var isOnHouseMenu by rememberSaveable { mutableStateOf(false) }

    // Pantalla principal, pantalla de edici√≥n o pantalla de casas basada en el estado
    when {
        isEditing -> {
            // Mostrar pantalla de edici√≥n de usuario
            EditUserScreen(onSave = {
                isEditing = false // Volver al men√∫ del usuario una vez que se guardan los datos
            })
        }

        isViewingHouses -> {
            // Mostrar pantalla de casas
            ViewHousesScreen(onBack = {
                isViewingHouses = false // Volver al men√∫ de usuario
            })
        }

        isOnHouseMenu-> {
            RentedHouse(onBack = {
                isOnHouseMenu = false // Volver al men√∫ de usuario
            })
        }

        else -> {
            // Mostrar pantalla del men√∫ de usuario
            UserMenuContent(
                onEdit = { isEditing = true }, // Cambiar el estado a edici√≥n
                onViewHouses = { isViewingHouses = true }, // Cambiar el estado a ver casas
                onViewRented = {isOnHouseMenu = true}
            )
        }
    }
}

@Composable
fun RentedHouse(onBack: () -> Unit) {

    // Aqu√≠ puedes agregar el contenido de la pantalla de ver casas
    Column(
        modifier = Modifier
            .fillMaxSize()
            .padding(16.dp)
            .verticalScroll(rememberScrollState())
    ) {
        Spacer(modifier = Modifier.height(16.dp))
        Text("Dispositivos:")
        Spacer(modifier = Modifier.height(8.dp))
        Text("Luz:")
        Button(onClick = {
            LightsOn("luz prendida")
        }) {
            Text("Activar luz")
        }
        Button(onClick = {
            LightsOff("luz apagada")
        }) {
            Text("Desactivar luz")
        }

        Spacer(modifier = Modifier.height(8.dp))
        Text("Servo:")
        Button(onClick = {
            move("moviendo")
        }) {
            Text("Mover")
        }

        Spacer(modifier = Modifier.height(8.dp))
        Text("Buzzer:")
        Button(onClick = {
            sound("sonando")
        }) {
            Text("Sonar")
        }
        Spacer(modifier = Modifier.height(8.dp))
        Button(onClick = onBack) {
            Text("Volver al men√∫")
        }
    }
}

@Preview(showBackground = true)
@Composable
fun PreviewUserMenuScreen() {
    UserMenuScreen()
}


@Composable
fun UserMenuContent(onEdit: () -> Unit, onViewHouses: () -> Unit, onViewRented: () -> Unit) {
    Column(
        modifier = Modifier.fillMaxSize(),
        verticalArrangement = Arrangement.Center,
        horizontalAlignment = Alignment.CenterHorizontally
    ) {
        Text("Bienvenido, ${currentUser.alias}")

        Spacer(modifier = Modifier.height(16.dp))

        // Bot√≥n para editar datos
        Button(onClick = onEdit) {
            Text("Editar datos")
        }

        Spacer(modifier = Modifier.height(16.dp))

        // Bot√≥n para ver casas disponibles
        Button(onClick = onViewHouses) {
            Text("Ver casas disponibles")
        }

        Spacer(modifier = Modifier.height(16.dp))


        if (currentUser.IsRenting){
            Button(onClick = onViewRented) {
                Text("Ver casa")
            }

            Spacer(modifier = Modifier.height(16.dp))
        }

        // Bot√≥n para cerrar sesi√≥n
        Button(onClick = {
            isLoggedIn = false
            isAdmin = false
        }) {
            Text("Cerrar sesi√≥n")
        }
    }
}

@Composable
fun DatePicker(): String {
    // Estado para almacenar la fecha seleccionada
    var selectedDate by remember { mutableStateOf("") }

    // Crear un calendario para obtener la fecha actual
    val calendar = Calendar.getInstance()
    val year = calendar.get(Calendar.YEAR)
    val month = calendar.get(Calendar.MONTH)
    val day = calendar.get(Calendar.DAY_OF_MONTH)

    // Crear el DatePickerDialog
    val datePickerDialog = DatePickerDialog(
        LocalContext.current,
        { _, selectedYear, selectedMonth, selectedDayOfMonth ->
            selectedDate = "$selectedDayOfMonth/${selectedMonth + 1}/$selectedYear"
        },
        year, month, day
    )

    // UI para mostrar el DatePicker cuando se hace clic en el texto
    Column(
        modifier = Modifier
            .fillMaxSize()
            .padding(16.dp),
        horizontalAlignment = Alignment.CenterHorizontally,
        verticalArrangement = Arrangement.Center
    ) {
        Text(
            text = if (selectedDate.isNotEmpty()) selectedDate else "Selecciona una fecha",
            fontSize = 18.sp,
            fontWeight = FontWeight.Bold,
            modifier = Modifier
                .clickable { datePickerDialog.show() }
                .padding(16.dp)
        )
    }
    return selectedDate
}

@Composable
fun ViewHousesScreen(onBack: () -> Unit) {
    val context = LocalContext.current
    var showDialog by remember { mutableStateOf(false) } // Estado para mostrar el di√°logo
    var selectedHouse by remember { mutableStateOf("") } // Casa seleccionada
    // Aqu√≠ puedes agregar el contenido de la pantalla de ver casas
    Column(
        modifier = Modifier
            .fillMaxSize()
            .padding(16.dp)
            .verticalScroll(rememberScrollState())
    ) {
        Spacer(modifier = Modifier.height(16.dp))
        Text("Elija fecha inicial y final")
        // Simulaci√≥n de fechas
        var startDate by remember { mutableStateOf("") }
        var endDate by remember { mutableStateOf("") }

        // Puedes reemplazar esto con un DatePicker real
        Button(onClick = { startDate = "01/01/2024" }) {
            Text("Seleccionar Fecha Inicial: $startDate")
        }
        Spacer(modifier = Modifier.height(8.dp))
        Button(onClick = { endDate = "31/01/2024" }) {
            Text("Seleccionar Fecha Final: $endDate")
        }

        Spacer(modifier = Modifier.height(16.dp))

        Button(onClick = {
            Toast.makeText(context, "Filtro aplicado", Toast.LENGTH_SHORT).show()
        }) {
            Text("Filtrar")
        }

        Spacer(modifier = Modifier.height(16.dp))
        Text("Casas Disponibles")
        Spacer(modifier = Modifier.height(8.dp))
        var i = 1

        for (house in MainActivity.globalHouseList) {
            if (house.status){
                Text("Casa: ${i}")
                Text("Capacidad: ${house.capacity}")
                Text("Habitaciones: ${house.rooms}")
                Text("Ba√±os: ${house.bathrooms}")
                Text("Amenidades: ${house.amenities}")
                Text("Caracter√≠sticas Generales: ${house.generalFeatures}")
                Text("Plan de Pago: ${house.paymentPlan}")
                i++
                Button(onClick = {
                    if (isCardValid(currentUser.card)) {
                        selectedHouse = "Casa $i"
                        showDialog = true
                    } else {
                        Toast.makeText(context, "Por favor, a√±ade una tarjeta primero", Toast.LENGTH_SHORT).show()
                    }
                }) {
                    Text("Alquilar")
                }
                Spacer(modifier = Modifier.height(16.dp))
            }else{
                Text(text= "Casa: ${i}", modifier= Modifier, color = androidx.compose.ui.graphics.Color.Blue)
                Text(text="Capacidad: ${house.capacity}" , modifier= Modifier, color = androidx.compose.ui.graphics.Color.Blue)
                Text(text="Habitaciones: ${house.rooms}", modifier= Modifier, color = androidx.compose.ui.graphics.Color.Blue)
                Text(text="Ba√±os: ${house.bathrooms}", modifier= Modifier, color = androidx.compose.ui.graphics.Color.Blue)
                Text(text="Amenities: ${house.amenities}", modifier= Modifier, color = androidx.compose.ui.graphics.Color.Blue)
                Text(text="Caracter√≠sticas Generales: ${house.generalFeatures}",modifier= Modifier, color = androidx.compose.ui.graphics.Color.Blue)
                Text(text="Plan de Pago: ${house.paymentPlan}", modifier= Modifier, color = androidx.compose.ui.graphics.Color.Blue)
                i= i+1

                Spacer(modifier = Modifier.height(16.dp))
            }
        }
        Spacer(modifier = Modifier.height(16.dp))

        Button(onClick = onBack) {
            Text("Volver al men√∫")
        }
        // AlertDialog para "Pagar primer mes"
        if (showDialog) {
            AlertDialog(
                onDismissRequest = { showDialog = false },
                title = {
                    Text("Confirmar Alquiler")
                },
                text = {
                    Text("¬øDeseas pagar el primer mes del ${selectedHouse}?")
                },
                confirmButton = {
                    Button(
                        onClick = {
                            showDialog = false
                            Toast.makeText(context, "Pago del primer mes realizado", Toast.LENGTH_SHORT).show()
                            currentUser.IsRenting = true
                        }
                    ) {
                        Text("Pagar primer mes")
                    }
                },
                dismissButton = {
                    Button(
                        onClick = {
                            showDialog = false
                        }
                    ) {
                        Text("Cancelar")
                    }
                }
            )
        }
    }
}

@Composable
fun EditUserScreen(onSave: () -> Unit) {
    val context = LocalContext.current
    var alias by rememberSaveable { mutableStateOf(currentUser.alias) }
    var fullName by rememberSaveable { mutableStateOf(currentUser.fullName) }
    var email by rememberSaveable { mutableStateOf(currentUser.email) }
    var cardnumber by rememberSaveable { mutableStateOf(currentUser.card.cardNumber) }
    var carddate by rememberSaveable { mutableStateOf(currentUser.card.expiryDate) }
    var cardcode by rememberSaveable { mutableStateOf(currentUser.card.securityCode) }
    var cardname by rememberSaveable { mutableStateOf(currentUser.card.cardholderName) }


    // Selector de tipo de casa
    val houseTypes = listOf("Apartamento Inteligente", "Apartamento Normal", "Casa Normal", "Casa con Apartamento")
    var selectedHouseType by rememberSaveable { mutableStateOf(currentUser.houseType) }
    var expandedHouseType by rememberSaveable { mutableStateOf(false) }

    // Selector de tipo de veh√≠culo
    val vehicleTypes = listOf("Bicicleta", "Carro", "Moto", "Otro")
    var selectedVehicleType by rememberSaveable { mutableStateOf(currentUser.vehicleType) }
    var expandedVehicleType by rememberSaveable { mutableStateOf(false) }

    Column(
        modifier = Modifier
            .fillMaxSize()
            .padding(8.dp),
        verticalArrangement = Arrangement.Center,
        horizontalAlignment = Alignment.CenterHorizontally
    ) {
        Text("Editar datos", style = MaterialTheme.typography.headlineSmall)

        Spacer(modifier = Modifier.height(8.dp))

        BasicTextField(
            value = alias,
            onValueChange = { alias = it },
            modifier = Modifier
                .fillMaxWidth()
                .padding(8.dp),
            decorationBox = { innerTextField ->
                Box(modifier = Modifier.padding(8.dp)) {
                    if (alias.isEmpty()) Text("Usuario (alias)")
                    innerTextField()
                }
            }
        )

        BasicTextField(
            value = fullName,
            onValueChange = { fullName = it },
            modifier = Modifier
                .fillMaxWidth()
                .padding(8.dp),
            decorationBox = { innerTextField ->
                Box(modifier = Modifier.padding(8.dp)) {
                    if (fullName.isEmpty()) Text("Nombre completo")
                    innerTextField()
                }
            }
        )

        BasicTextField(
            value = email,
            onValueChange = { email = it },
            modifier = Modifier
                .fillMaxWidth()
                .padding(8.dp),
            decorationBox = { innerTextField ->
                Box(modifier = Modifier.padding(8.dp)) {
                    if (email.isEmpty()) Text("Correo electr√≥nico")
                    innerTextField()
                }
            }
        )

        BasicTextField(
            value = cardname,
            onValueChange = { cardname = it },
            modifier = Modifier
                .fillMaxWidth()
                .padding(8.dp),
            decorationBox = { innerTextField ->
                Box(modifier = Modifier.padding(8.dp)) {
                    if (cardname.isEmpty()) Text("Nombre del tarjehabitante")
                    innerTextField()
                }
            }
        )

        BasicTextField(
            value = cardnumber,
            onValueChange = { cardnumber = it },
            modifier = Modifier
                .fillMaxWidth()
                .padding(8.dp),
            decorationBox = { innerTextField ->
                Box(modifier = Modifier.padding(8.dp)) {
                    if (cardnumber.isEmpty()) Text("Numero de tarjeta")
                    innerTextField()
                }
            }
        )

        BasicTextField(
            value = carddate,
            onValueChange = { carddate = it },
            modifier = Modifier
                .fillMaxWidth()
                .padding(8.dp),
            decorationBox = { innerTextField ->
                Box(modifier = Modifier.padding(8.dp)) {
                    if (carddate.isEmpty()) Text("Expiracion de tarjeta")
                    innerTextField()
                }
            }
        )

        BasicTextField(
            value = cardcode,
            onValueChange = { cardcode = it },
            modifier = Modifier
                .fillMaxWidth()
                .padding(8.dp),
            decorationBox = { innerTextField ->
                Box(modifier = Modifier.padding(8.dp)) {
                    if (cardcode.isEmpty()) Text("Codigo de tarjeta")
                    innerTextField()
                }
            }
        )

        Spacer(modifier = Modifier.height(8.dp))

        // Selector de tipo de casa
        Text("Seleccione el tipo de casa:")
        Box {
            Button(onClick = { expandedHouseType = !expandedHouseType }) {
                Text(selectedHouseType)
            }
            DropdownMenu(
                expanded = expandedHouseType,
                onDismissRequest = { expandedHouseType = false }
            ) {
                houseTypes.forEach { houseType ->
                    DropdownMenuItem(
                        text = { Text(houseType) },
                        onClick = {
                            selectedHouseType = houseType
                            expandedHouseType = false
                        }
                    )
                }
            }
        }

        Spacer(modifier = Modifier.height(16.dp))

        // Selector de tipo de veh√≠culo
        Text("Seleccione el tipo de veh√≠culo:")
        Box {
            Button(onClick = { expandedVehicleType = !expandedVehicleType }) {
                Text(selectedVehicleType)
            }
            DropdownMenu(
                expanded = expandedVehicleType,
                onDismissRequest = { expandedVehicleType = false }
            ) {
                vehicleTypes.forEach { vehicleType ->
                    DropdownMenuItem(
                        text = { Text(vehicleType) },
                        onClick = {
                            selectedVehicleType = vehicleType
                            expandedVehicleType = false
                        }
                    )
                }
            }
        }

        Spacer(modifier = Modifier.height(16.dp))

        Button(onClick = {
            val oldUser = currentUser.alias
            // Guardar los cambios
            currentUser.alias = alias
            currentUser.fullName = fullName
            currentUser.email = email
            currentUser.houseType = selectedHouseType
            currentUser.vehicleType = selectedVehicleType
            currentUser.card.cardNumber = cardnumber
            currentUser.card.cardholderName = cardname
            currentUser.card.expiryDate = carddate
            currentUser.card.securityCode = cardcode


            onSave()  // Llamar al callback de guardado
            saveUserToFile(context, currentUser) // Pasa el contexto y el usuario

            deleteUserFromFile(context, oldUser) //Elimina informacion anterior
        }) {
            Text("Guardar cambios")
        }

        Spacer(modifier = Modifier.height(16.dp))

        Button(onClick = onSave) {
            Text("Cancelar")
        }
    }
}

@Preview(showBackground = true)
@Composable
fun PreviewEditUserScreen() {
    EditUserScreen(onSave = {})
}

// Ventana de registro de usuario
@Composable
fun RegisterUserScreen(
    onBack: () -> Unit,
    onPaymentClick: () -> Unit
) {
    // Recupera los datos del usuario al iniciar la pantalla de registro
    val tempUser = MainActivity.tempUser
    var alias by rememberSaveable { mutableStateOf(tempUser?.alias ?: "") }
    var fullName by rememberSaveable { mutableStateOf(tempUser?.fullName ?: "") }
    var email by rememberSaveable { mutableStateOf(tempUser?.email ?: "") }
    var password by rememberSaveable { mutableStateOf(tempUser?.password ?: "") }
    var dateOfBirth by rememberSaveable { mutableStateOf("") }
    val dateOfBirthPattern = Regex("""\d{2}/\d{2}/\d{4}""")
    var houseType by rememberSaveable { mutableStateOf(tempUser?.houseType ?: "") }
    var vehicleType by rememberSaveable { mutableStateOf(tempUser?.vehicleType ?: "") }
    val context = LocalContext.current

    Column(
        modifier = Modifier
            .fillMaxSize()
            .padding(16.dp),
        verticalArrangement = Arrangement.Top,
        horizontalAlignment = Alignment.CenterHorizontally
    ) {

        Spacer(modifier = Modifier.height(25.dp))

        // Campos de texto para el registro de usuario
        BasicTextField(
            value = alias,
            onValueChange = { alias = it },
            modifier = Modifier
                .fillMaxWidth()
                .padding(8.dp),
            decorationBox = { innerTextField ->
                Box(modifier = Modifier.padding(8.dp)) {
                    if (alias.isEmpty()) Text("Alias")
                    innerTextField()
                }
            }
        )

        BasicTextField(
            value = fullName,
            onValueChange = { fullName = it },
            modifier = Modifier
                .fillMaxWidth()
                .padding(8.dp),
            decorationBox = { innerTextField ->
                Box(modifier = Modifier.padding(8.dp)) {
                    if (fullName.isEmpty()) Text("Nombre Completo")
                    innerTextField()
                }
            }
        )

        BasicTextField(
            value = email,
            onValueChange = { email = it },
            modifier = Modifier
                .fillMaxWidth()
                .padding(8.dp),
            decorationBox = { innerTextField ->
                Box(modifier = Modifier.padding(8.dp)) {
                    if (email.isEmpty()) Text("Email")
                    innerTextField()
                }
            }
        )

        BasicTextField(
            value = password,
            onValueChange = { password = it },
            modifier = Modifier
                .fillMaxWidth()
                .padding(8.dp),
            visualTransformation = PasswordVisualTransformation(),
            decorationBox = { innerTextField ->
                Box(modifier = Modifier.padding(8.dp)) {
                    if (password.isEmpty()) Text("Contrase√±a")
                    innerTextField()
                }
            }
        )

        Spacer(modifier = Modifier.height(16.dp))

        // Campo de texto para la fecha de nacimiento con autoformateo
        DateInputField(
            date = dateOfBirth,
            onDateChange = { dateOfBirth = it }
        )

        // Validaci√≥n de la fecha al salir del campo
        if (dateOfBirth.isNotEmpty() && !dateOfBirth.matches(dateOfBirthPattern)) {
            Text(
                text = "Por favor ingresa la fecha de nacimiento en el formato dd/mm/aaaa",
                modifier = Modifier.padding(top = 8.dp)
            )
        }

        Spacer(modifier = Modifier.height(16.dp))


        // Selector de tipo de casa
        val houseTypes = listOf(
            "Apartamento Inteligente",
            "Apartamento Normal",
            "Casa Normal",
            "Casa con Apartamento"
        )
        var selectedHouseType by rememberSaveable { mutableStateOf(houseType) }
        var expandedHouseType by rememberSaveable { mutableStateOf(false) }
        Box {
            Button(onClick = { expandedHouseType = !expandedHouseType }) {
                Text(if (selectedHouseType.isEmpty()) "Seleccionar tipo de casa" else selectedHouseType)
            }
            DropdownMenu(
                expanded = expandedHouseType,
                onDismissRequest = { expandedHouseType = false }
            ) {
                houseTypes.forEach { type ->
                    DropdownMenuItem(
                        text = { Text(type) },
                        onClick = {
                            selectedHouseType = type // Cambiar al tipo seleccionado
                            expandedHouseType = false
                        }
                    )
                }
            }
        }

        Spacer(modifier = Modifier.height(16.dp))

        // Selector de tipo de veh√≠culo
        val vehicleTypes = listOf("Bicicleta", "Carro", "Moto", "Otro")
        var selectedVehicleType by rememberSaveable { mutableStateOf(vehicleType) }
        var expandedVehicleType by rememberSaveable { mutableStateOf(false) }
        Box {
            Button(onClick = { expandedVehicleType = !expandedVehicleType }) {
                Text(if (selectedVehicleType.isEmpty()) "Seleccionar tipo de vehiculo" else selectedVehicleType)
            }
            DropdownMenu(
                expanded = expandedVehicleType,
                onDismissRequest = { expandedVehicleType = false }
            ) {
                vehicleTypes.forEach { type ->
                    DropdownMenuItem(
                        text = { Text(type) },
                        onClick = {
                            selectedVehicleType = type
                            expandedVehicleType = false
                        }
                    )
                }
            }
        }

        Spacer(modifier = Modifier.height(24.dp))

        // Contenedor para botones "Volver" y "Registrar Usuario"
        Row(
            modifier = Modifier
                .fillMaxWidth()
                .padding(horizontal = 8.dp),
            horizontalArrangement = Arrangement.SpaceBetween
        ) {
            Button(onClick = onBack) {
                Text("Volver")
            }

            Button(onClick = {
                val user =
                    User(alias, fullName, email, password, dateOfBirth, selectedHouseType, selectedVehicleType)
                if (isPasswordValid(password)) {
                    saveUserToFile(context, user)
                    Toast.makeText(context, "Usuario registrado exitosamente", Toast.LENGTH_LONG)
                        .show()
                    MainActivity.tempUser = null
                    onBack()
                } else {
                    Toast.makeText(context, "Contrase√±a inv√°lida", Toast.LENGTH_LONG).show()
                }
            }) {
                Text("Registrar Usuario")
            }
        }

        Spacer(modifier = Modifier.height(16.dp))

        // Bot√≥n para ingresar datos de tarjeta
        Button(onClick = {
            MainActivity.tempUser = User(
                alias = alias,
                fullName = fullName,
                email = email,
                password = password,
                dateOfBirth = dateOfBirth,  // Aqu√≠ no es necesario convertirlo
                houseType = selectedHouseType,
                vehicleType = selectedVehicleType,
                card = CardInfo("1","1","1", "1")
            )
            onPaymentClick()
        }) {
            Text("Ingresar datos de Tarjeta")
        }
    }
}


// Campo de texto para la fecha de nacimiento con autoformateo
@Composable
fun DateInputField(date: String, onDateChange: (String) -> Unit) {
    OutlinedTextField(
        value = formatDateString(date),
        onValueChange = { input ->
            // Filtrar la entrada solo para permitir d√≠gitos
            val filteredInput = input.filter { it.isDigit() }
            onDateChange(filteredInput) // Llama a la funci√≥n de cambio de fecha
        },
        label = { Text("Fecha de nacimiento (dd/mm/aaaa)") },
        modifier = Modifier.fillMaxWidth()
    )
}

// Funci√≥n para formatear la fecha autom√°ticamente mientras el usuario escribe
fun formatDateString(input: String): String {
    // Filtra solo los d√≠gitos y limita a 8 caracteres para ddMMyyyy
    val digits = input.filter { it.isDigit() }.take(8)

    // Construye el formato dd/mm/aaaa autom√°ticamente
    return buildString {
        for (i in digits.indices) {
            append(digits[i])
            // A√±ade la barra despu√©s del segundo d√≠gito del d√≠a y del mes
            if (i == 1 || i == 3) append("/")
        }
    }
}



@Preview(showBackground = true)
@Composable
fun PreviewRegisterUserScreen() {
    RegisterUserScreen(
        onBack = {}, // Puedes dejar esto vac√≠o
        onPaymentClick = {} // Esto tambi√©n, ya que solo es una vista previa
    )
}

@Composable
fun PaymentScreen(onBack: () -> Unit){  // Aceptar un callback para volver
    var cardholderName by rememberSaveable { mutableStateOf("") }
    var cardNumber by rememberSaveable { mutableStateOf("") }
    var expiryDate by rememberSaveable { mutableStateOf("") }
    var securityCode by rememberSaveable { mutableStateOf("") }
    var errorMessage by rememberSaveable { mutableStateOf<String?>(null) }
    var cardBrand by rememberSaveable { mutableStateOf<String?>(null) }

    val context = LocalContext.current

    Column(
        modifier = Modifier
            .fillMaxSize()
            .padding(16.dp),
        verticalArrangement = Arrangement.Center,
        horizontalAlignment = Alignment.CenterHorizontally
    ) {
        // Nombre del Tarjetahabiente
        BasicTextField(
            value = cardholderName,
            onValueChange = { cardholderName = it },
            modifier = Modifier
                .fillMaxWidth()
                .padding(8.dp),
            decorationBox = { innerTextField ->
                Box(modifier = Modifier.padding(16.dp)) {
                    if (cardholderName.isEmpty()) Text("Nombre del Tarjetahabiente")
                    innerTextField()
                }
            }
        )

        // N√∫mero de tarjeta
        BasicTextField(
            value = cardNumber,
            onValueChange = {
                if (it.length <= 16) {
                    cardNumber = it
                    validateCardNumber(it)?.let { brand ->
                        cardBrand = brand
                        errorMessage = null
                    } ?: run {
                        cardBrand = null
                        errorMessage = "El n√∫mero de tarjeta no es v√°lido. Verifique el primer d√≠gito."
                    }
                }
            },
            modifier = Modifier
                .fillMaxWidth()
                .padding(8.dp),
            keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Number),
            decorationBox = { innerTextField ->
                Box(modifier = Modifier.padding(16.dp)) {
                    if (cardNumber.isEmpty()) Text("N√∫mero de tarjeta (16 d√≠gitos)")
                    innerTextField()
                }
            }
        )

        // Fecha de validez (Mes/A√±o)
        BasicTextField(
            value = expiryDate,
            onValueChange = { expiryDate = it },
            modifier = Modifier
                .fillMaxWidth()
                .padding(8.dp),
            decorationBox = { innerTextField ->
                Box(modifier = Modifier.padding(16.dp)) {
                    if (expiryDate.isEmpty()) Text("Fecha de Validez (MM/AA)")
                    innerTextField()
                }
            }
        )

        // N√∫mero verificador
        BasicTextField(
            value = securityCode,
            onValueChange = {
                if (it.length <= 4) {
                    securityCode = it
                }
            },
            modifier = Modifier
                .fillMaxWidth()
                .padding(8.dp),
            keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Number),
            decorationBox = { innerTextField ->
                Box(modifier = Modifier.padding(16.dp)) {
                    if (securityCode.isEmpty()) Text("N√∫mero Verificador (4 d√≠gitos)")
                    innerTextField()
                }
            }
        )

        // Mensajes de error y marca de la tarjeta
        if (errorMessage != null) {
            Text(text = errorMessage!!, color = MaterialTheme.colorScheme.error, modifier = Modifier.padding(8.dp))
        } else if (cardBrand != null) {
            Text(text = "Marca de la tarjeta: $cardBrand", modifier = Modifier.padding(8.dp))
        }

        Spacer(modifier = Modifier.height(16.dp))

        // Bot√≥n para confirmar el pago
        Button(onClick = {
            if (cardNumber.length == 16 && securityCode.length == 4 && cardBrand != null) {
                MainActivity.cardInfo = CardInfo(
                    cardholderName = cardholderName,
                    cardNumber = cardNumber,
                    expiryDate = expiryDate,
                    securityCode = securityCode
                )
                Toast.makeText(context, "Datos agregados con √©xito", Toast.LENGTH_LONG).show()
                onBack()  // Regresar a la pantalla anterior
            } else {
                Toast.makeText(context, "Verifica la informaci√≥n ingresada", Toast.LENGTH_LONG).show()
            }
        }) {
            Text("Confirmar Datos")
        }

        Spacer(modifier = Modifier.height(16.dp))

        // Bot√≥n para volver a la pantalla de registro
        Button(onClick = onBack) {
            Text("Volver a Registro")
        }
    }
}


// Preview para visualizar PaymentScreen
@Preview(showBackground = true)
@Composable
fun PaymentScreenPreview() {
    PaymentScreen(onBack = { /* Acci√≥n para volver */ })
}

// Funci√≥n para validar el n√∫mero de tarjeta y determinar la marca
fun validateCardNumber(cardNumber: String): String? {
    return when (cardNumber.firstOrNull()) {
        '1' -> "Visca"
        '2' -> "MasterChef"
        '3' -> "AmericanCity"
        '5' -> "TicaPay"
        else -> null
    }
}

fun isCardValid(tarjeta: CardInfo): Boolean {
    // Verificar si la longitud del n√∫mero de la tarjeta es correcta
    if (tarjeta.cardNumber.length != 16) return false

    // Obtener el primer car√°cter del n√∫mero de tarjeta
    val firstDigit = tarjeta.cardNumber.firstOrNull() ?: return false

    // Verificar si el primer d√≠gito es uno de los permitidos
    return firstDigit in listOf('1', '2', '3', '5')
}

// Funci√≥n para leer los datos de usuario desde el archivo
fun readUserDataFromFile(context: Context, alias: String): User {
    val file = File(context.filesDir, "users.txt")
    if (file.exists()) {
        val lines = file.readLines()
        for (line in lines) {
            val parts = line.split(",")
            if (parts.size == 7 && parts[0] == alias) {
                return User(
                    alias = parts[0],
                    fullName = parts[1],
                    email = parts[2],
                    password = parts[3],
                    dateOfBirth = parts[4], // Convertir el campo de edad a entero
                    houseType = parts[5],
                    vehicleType = parts[6]
                )
            }
        }
    }
    return User("A", "B", "C", "D", "E", "F", "G")
}

fun readUserDataByEmail(context: Context, email: String): User? {
    val file = File(context.filesDir, "users.txt")
    if (file.exists()) {
        val lines = file.readLines()
        for (line in lines) {
            val parts = line.split(",")
            if (parts.size == 7 && parts[2] == email) {
                return User(
                    alias = parts[0],
                    fullName = parts[1],
                    email = parts[2],
                    password = parts[3],
                    dateOfBirth = parts[4],
                    houseType = parts[5],
                    vehicleType = parts[6]
                )
            }
        }
    }
    return null
}

fun sendRecoveryCode(context: Context, email: String) {
    // Verifica si el correo existe en la lista de usuarios
    val user = readUserDataByEmail(context, email)
    if (user == null) {
        // Mostrar mensaje si el correo no existe
        Toast.makeText(context, "Correo no encontrado", Toast.LENGTH_SHORT).show()
        return
    }

    // Genera el c√≥digo de recuperaci√≥n
    val code = (10000..99999).random().toString()

    // Guarda el c√≥digo en SharedPreferences
    val sharedPreferences = context.getSharedPreferences("RecoveryPrefs", Context.MODE_PRIVATE)
    sharedPreferences.edit().putString("recovery_code", code).putString("recovery_email", email).apply()

    // Enviar el c√≥digo por correo electr√≥nico
    sendEmail(email, code)

    // Mostrar mensaje de confirmaci√≥n de env√≠o
    Toast.makeText(context, "C√≥digo enviado al correo: $email", Toast.LENGTH_LONG).show()
}

private fun sendEmail(toEmail: String, code: String) {
    // Configuraci√≥n del servidor SMTP
    val props = Properties()
    props["mail.smtp.auth"] = "true"
    props["mail.smtp.starttls.enable"] = "true"
    props["mail.smtp.host"] = "587.gmail.com" // Cambiar seg√∫n tu servidor SMTP
    props["mail.smtp.port"] = "587"

    // Credenciales del remitente
    val username = "tr9j1x@gmail.com" // Reemplaza con tu correo
    val password = "Tr9j1x1208" // Reemplaza con tu contrase√±a o token de aplicaci√≥n

    val session = Session.getInstance(props, object : Authenticator() {
        override fun getPasswordAuthentication(): PasswordAuthentication {
            return PasswordAuthentication(username, password)
        }
    })

    try {
        val message = MimeMessage(session)
        message.setFrom(InternetAddress(username))
        message.setRecipients(Message.RecipientType.TO, InternetAddress.parse(toEmail))
        message.subject = "C√≥digo de recuperaci√≥n de cuenta"
        message.setText("Su c√≥digo de verificaci√≥n es: $code")

        // Enviar el mensaje
        Transport.send(message)
    } catch (e: Exception) {
        e.printStackTrace()
    }
}
fun saveNewPassword(context: Context, newPassword: String) {
    val sharedPreferences = context.getSharedPreferences("RecoveryPrefs", Context.MODE_PRIVATE)
    val email = sharedPreferences.getString("recovery_email", "")

    if (email != null && email.isNotEmpty()) {
        val file = File(context.filesDir, "users.txt")
        if (file.exists()) {
            val lines = file.readLines().toMutableList()
            val updatedLines = lines.map { line ->
                val parts = line.split(",")
                if (parts.size == 7 && parts[2] == email) {
                    "${parts[0]},${parts[1]},$email,$newPassword,${parts[4]},${parts[5]},${parts[6]}"
                } else {
                    line
                }
            }
            file.writeText(updatedLines.joinToString("\n"))
            Toast.makeText(context, "Contrase√±a actualizada exitosamente", Toast.LENGTH_SHORT).show()
        }
    }
}

// Funci√≥n para leer todos los usuarios
fun readAllUsers(context: Context): List<User> {
    val file = File(context.filesDir, "users.txt")
    val users = mutableListOf<User>()
    if (file.exists()) {
        val lines = file.readLines()
        for (line in lines) {
            val parts = line.split(",")
            if (parts.size == 7) {
                users.add(
                    User(
                        alias = parts[0],
                        fullName = parts[1],
                        email = parts[2],
                        password = parts[3],
                        dateOfBirth = parts[4],
                        houseType = parts[5],
                        vehicleType = parts[6]
                    )
                )
            }
        }
    }
    return users
}

// Funci√≥n para verificar si el alias o el correo ya existen
fun isUserAlreadyRegistered(context: Context, alias: String, email: String): Boolean {
    val file = File(context.filesDir, "users.txt")
    if (file.exists()) {
        val lines = file.readLines()
        for (line in lines) {
            val parts = line.split(",")
            if (parts.size == 7) {
                val existingAlias = parts[0]
                val existingEmail = parts[2]
                if (existingAlias == alias || existingEmail == email) {
                    return true // Alias o correo ya est√°n en uso
                }
            }
        }
    }
    return false
}



// Funci√≥n para recordar al admin que cambie la contrase√±a cada 2 minutos usando notificaciones
fun startPasswordReminder(context: Context) {
    val handler = Handler(Looper.getMainLooper())

    // Crear el canal de notificaciones
    if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {
        val channel = NotificationChannel(
            "PASSWORD_REMINDER",
            "Recordatorio de Contrase√±a",
            NotificationManager.IMPORTANCE_HIGH
        ).apply {
            description = "Recordatorio para cambiar la contrase√±a predeterminada"
        }
        val notificationManager: NotificationManager =
            context.getSystemService(NotificationManager::class.java)
        notificationManager.createNotificationChannel(channel)
    }

    val reminderRunnable = object : Runnable {
        @SuppressLint("MissingPermission")
        override fun run() {
            val builder = NotificationCompat.Builder(context, "PASSWORD_REMINDER")
                .setSmallIcon(R.drawable.ic_dialog_alert)
                .setContentTitle("Recordatorio de contrase√±a")
                .setContentText("Por favor cambie su contrase√±a predeterminada")
                .setPriority(NotificationCompat.PRIORITY_DEFAULT)

            with(NotificationManagerCompat.from(context)) {
                notify(1, builder.build())
            }

            // Repetir la llamada cada 2 minutos (120000 ms)
            handler.postDelayed(this, 120000)
        }
    }

    // Iniciar el recordatorio
    handler.post(reminderRunnable)
}

fun LightsOn(msj: String){
    CoroutineScope(Dispatchers.IO).launch {
        try {
            // Conectar al servidor
            val socket = Socket("10.0.2.2", 12345) // Cambia <TU_IP_LOCAL> por la IP del servidor

            // Enviar el mensaje al servidor
            val outputStream = DataOutputStream(socket.getOutputStream())
            outputStream.writeUTF(msj)

            // Recibir la respuesta del servidor
            val inputStream = DataInputStream(socket.getInputStream())
            val respuesta = inputStream.readUTF()

            // Imprimir la respuesta en los logs
            println("Respuesta del servidor: $respuesta")

            // Cerrar el socket
            socket.close()
        } catch (e: Exception) {
            e.printStackTrace()
        }
    }
}

fun LightsOff(msj: String){
    CoroutineScope(Dispatchers.IO).launch {
        try {
            // Conectar al servidor
            val socket = Socket("10.0.2.2", 12345) // Cambia <TU_IP_LOCAL> por la IP del servidor

            // Enviar el mensaje al servidor
            val outputStream = DataOutputStream(socket.getOutputStream())
            outputStream.writeUTF(msj)

            // Recibir la respuesta del servidor
            val inputStream = DataInputStream(socket.getInputStream())
            val respuesta = inputStream.readUTF()

            // Imprimir la respuesta en los logs
            println("Respuesta del servidor: $respuesta")

            // Cerrar el socket
            socket.close()
        } catch (e: Exception) {
            e.printStackTrace()
        }
    }
}

fun move(msj: String){
    CoroutineScope(Dispatchers.IO).launch {
        try {
            // Conectar al servidor
            val socket = Socket("10.0.2.2", 12345) // Cambia <TU_IP_LOCAL> por la IP del servidor

            // Enviar el mensaje al servidor
            val outputStream = DataOutputStream(socket.getOutputStream())
            outputStream.writeUTF(msj)

            // Recibir la respuesta del servidor
            val inputStream = DataInputStream(socket.getInputStream())
            val respuesta = inputStream.readUTF()

            // Imprimir la respuesta en los logs
            println("Respuesta del servidor: $respuesta")

            // Cerrar el socket
            socket.close()
        } catch (e: Exception) {
            e.printStackTrace()
        }
    }
}

fun sound(msj: String){
    CoroutineScope(Dispatchers.IO).launch {
        try {
            // Conectar al servidor
            val socket = Socket("10.0.2.2", 12345) // Cambia <TU_IP_LOCAL> por la IP del servidor

            // Enviar el mensaje al servidor
            val outputStream = DataOutputStream(socket.getOutputStream())
            outputStream.writeUTF(msj)

            // Recibir la respuesta del servidor
            val inputStream = DataInputStream(socket.getInputStream())
            val respuesta = inputStream.readUTF()

            // Imprimir la respuesta en los logs
            println("Respuesta del servidor: $respuesta")

            // Cerrar el socket
            socket.close()
        } catch (e: Exception) {
            e.printStackTrace()
        }
    }
}